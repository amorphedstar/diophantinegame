<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diophantine Game</title>

    <link rel="stylesheet" href="main.css" />
    <link rel="stylesheet" href="game.css" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />

    <!-- Include MathJax rendering framework -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"
    ></script>
    <script type="text/x-mathjax-config">
      // allow dynamic equation linebreaking
      // see: https://stackoverflow.com/a/56106854
      MathJax.Hub.Config({
        loader: {load: ['[tex]/color']},
        tex: {packages: {'[+]': ['color']}},
        CommonHTML: { linebreaks: { automatic: true } },
        "HTML-CSS": { linebreaks: { automatic: true } },
               SVG: { linebreaks: { automatic: true } }
      });
      window.addEventListener("resize", MJrerender);

      let t = -1;
      let delay = 1000;
      function MJrerender() {
        if (t >= 0) {
          // If we are still waiting, then the user is still resizing =>
          // postpone the action further!
          window.clearTimeout(t);
        }
        t = window.setTimeout(function () {
          MathJax.Hub.Queue(["Rerender", MathJax.Hub, "equation"]);
          t = -1; // Reset the handle
        }, delay);
      }
    </script>
    <script>
      // framework for rerendering MathJax based on
      // https://cdn.jsdelivr.net/gh/mathjax/MathJax@2.7.1/test/sample-dynamic.html
      //
      //  Use a closure to hide the local variables from the
      //  global namespace
      //
      (function () {
        var QUEUE = MathJax.Hub.queue; // shorthand for the queue
        var jaxes = {},
          boxes = {}; // the element jax for the math output, and the box it's in

        //
        //  Hide and show the box (so it doesn't flicker as much)
        //
        var HIDEBOX = (boxid) =>
          function () {
            boxes[boxid].style.visibility = "hidden";
          };
        var SHOWBOX = (boxid) =>
          function () {
            boxes[boxid].style.visibility = "visible";
          };

        //
        //  Get the element jax when MathJax has produced it.
        //
        QUEUE.Push(function () {
          jaxes.equation = MathJax.Hub.getAllJax("equationOutput")[0];
          boxes.equation = document.getElementById("equation");
          SHOWBOX("equation"); // box is initially hidden so the braces don't show
          jaxes.assignment = MathJax.Hub.getAllJax("assignmentOutput")[0];
          boxes.assignment = document.getElementById("assignment");
          SHOWBOX("equation"); // box is initially hidden so the braces don't show
        });

        //
        //  The onchange event handler that typesets the math entered
        //  by the user.  Hide the box, then typeset, then show it again
        //  so we don't see a flash as the math is cleared and replaced.
        //
        window.UpdateMath = async function (id, TeX) {
          while (!(id in jaxes && id in boxes)) {
            await delay(100);
          }
          QUEUE.Push(
            HIDEBOX(id),
            // ["resetEquationNumbers", MathJax.InputJax.TeX],
            ["Text", jaxes[id], TeX],
            SHOWBOX(id)
          );
        };
        window.jaxes = jaxes;
        window.boxes = boxes;
      })();
    </script>
  </head>
  <body class="bg-dark text-light">
    <header class="container-fluid">
      <nav class="navbar fixed-top navbar-dark">
        <a class="navbar-brand" href="#">Diophantine Game</a>
        <menu class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="lobby.html">Lobby</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="play.html">Play</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="scores.html">Scores</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">About</a>
          </li>
        </menu>
      </nav>
    </header>

    <main class="bg-secondary">
      <div class="players">
        <p>
          Player:
          <span class="player-name" id="player-name"></span>
        </p>
        <p>
          Opponent:
          <span class="player-name" id="opponent-name"></span>
        </p>
        <div id="player-messages"></div>
      </div>

      <div class="game center-content">
        <h2 id="goal-text"></h2>

        <div class="equation" id="equation" style="visibility: hidden">
          <div id="equationOutput" class="output">$${}$$</div>
        </div>
        <br />

        <div class="center-content">
          <div class="assignment-container">
            <label
              for="assignment-text"
              class="equation"
              id="assignment"
              style="visibility: hidden"
            >
              <div id="assignmentOutput" class="output">$${}$$</div>
            </label>
            <input
              type="text"
              id="assignment-text"
              placeholder="Type an integer"
            />
          </div>
          <button disabled type="submit" class="btn btn-primary" id="submit">
            Submit
          </button>
        </div>
      </div>
    </main>

    <footer class="bg-dark text-dark text-muted">
      <div class="container-fluid">
        <span class="text-reset">Thomas Draper</span>
        <a
          class="text-reset"
          href="https://github.com/amorphedstar/diophantinegame"
          >Source</a
        >
      </div>
    </footer>

    <!-- Script is located at the bottom because it references HTML elements during initialization -->
    <script src="play.js"></script>
  </body>
</html>
